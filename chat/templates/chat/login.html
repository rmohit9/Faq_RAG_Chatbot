{% extends 'chat/base.html' %}
{% load static %}

{% block title %}AI ChatBot - Login{% endblock %}

{% block head_content %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'chat/css/login.css' %}">
{% endblock %}

{% block content %}
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="container">

            <!-- Logo -->
            <a class="navbar-brand" href="{% url 'home' %}">
                <img src="{% static 'chat/images/Graphura-logo-white.png' %}" alt="Graphura Logo"
                    style="height: 40px;">
            </a>

            <!-- Hamburger Menu -->
            <div id="navbar-toggle" class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <!-- Nav Links -->
            <ul class="nav-links" id="navbar-dropdown">
                <li><a href="{% url 'home' %}">Home</a></li>
                <li><a href="{% url 'chat' %}">Chat</a></li>
                <li><a href="{% url 'about' %}">About Us</a></li>
                <li><a href="{% url 'contact' %}">Contact Us</a></li>

                {% if user.is_staff %}
                <li><a href="{% url 'admin_dashboard' %}" class="nav-btn">Admin Dashboard</a></li>
                {% else %}
                <li><a href="{% url 'user_dashboard' %}" class="nav-btn">User Dashboard</a></li>
                {% endif %}

                {% if user.is_authenticated %}
                <li><a href="{% url 'logout' %}" class="nav-btn">Logout</a></li>
                {% else %}
                <li><a href="{% url 'login' %}" class="nav-btn">Login</a></li>
                {% endif %}
            </ul>

        </div>
    </nav>
<section class="login-section">
    <div class="form-container">

        <!-- LEFT FORM -->
        <div class="form-card">
            <h2>Welcome Back ðŸ‘‹</h2>
            <p>Please login to continue</p>

            <form method="POST" novalidate>
                {% csrf_token %}
                <div class="input-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" required>
                </div>

                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" required>
                </div>

                <div class="input-group captcha-group">
                    <label for="captcha">CAPTCHA</label>
                    <div class="captcha-display">
                        <img src="{% url 'captcha' %}" alt="CAPTCHA Image" id="captcha-image">
                        <button type="button" id="refresh-captcha" class="btn btn-secondary">Refresh</button>
                    </div>
                    <input type="text" id="captcha" name="captcha" placeholder="Enter CAPTCHA" required>
                </div>

                <button class="btn btn-primary" type="submit">Login</button>

                <p class="signup-link">
                    Don't have an account? <a href="{% url 'register' %}">Register</a>
                </p>
            </form>
        </div>

        <!-- RIGHT IMAGE -->
        <div class="form-image">
            <img src="{% static 'chat/images/graphic-cartoon-character-login-vector-37485992.jpg' %}" 
                 alt="Login Illustration">
        </div>

    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const captchaImage = document.getElementById('captcha-image');
        const refreshCaptchaBtn = document.getElementById('refresh-captcha');

        if (refreshCaptchaBtn && captchaImage) {
            refreshCaptchaBtn.addEventListener('click', function() {
                // Append a timestamp to the URL to force the browser to reload the image
                captchaImage.src = '{% url "captcha" %}' + '?' + new Date().getTime();
            });
        }
    });
</script>
{% endblock %}
